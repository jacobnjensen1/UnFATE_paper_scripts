#run 2nd when making numLoci figure (after extractSamples.py, before calcDistances.py)
#used to sample portions of the supermatrix that has already been reduced to the samples you care about
#the partitions list shows the start and end indeces (1-indexed from FASconCAT-G partition file) of each partition.
#The partitions should be identical when the same data is concatenated, so you shouldn't need to change partitions for now

from random import shuffle
from Bio import SeqIO
import argparse

parser=argparse.ArgumentParser()
parser.add_argument("-n", "--num", required=True)
args=parser.parse_args()

partitions = [["1","5291"],["5292","7761"],["7762","9574"],["9575","12181"],["12182","18682"],["18683","20935"],\
["20936","32606"],["32607","36004"],["36005","38999"],["39000","45497"],["45498","56367"],\
["56368","59866"],["59867","61901"],["61902","64664"],["64665","66928"],["66929","70413"],\
["70414","74234"],["74235","76021"],["76022","84448"],["84449","87996"],["87997","90494"],\
["90495","92548"],["92549","95111"],["95112","101227"],["101228","104015"],["104016","105316"],\
["105317","108378"],["108379","111161"],["111162","145270"],["145271","150817"],["150818","153259"],\
["153260","155686"],["155687","157625"],["157626","159617"],["159618","161791"],["161792","171380"],\
["171381","173243"],["173244","177211"],["177212","189708"],["189709","196991"],["196992","200415"],\
["200416","214787"],["214788","230368"],["230369","233428"],["233429","235169"],["235170","236515"],\
["236516","238728"],["238729","241336"],["241337","256677"],["256678","258632"],["258633","260900"],\
["260901","263179"],["263180","265142"],["265143","269019"],["269020","270558"],["270559","272703"],\
["272704","275528"],["275529","277473"],["277474","282111"],["282112","283721"],["283722","285284"],\
["285285","291719"],["291720","305694"],["305695","309663"],["309664","317910"],["317911","320688"],\
["320689","324898"],["324899","327110"],["327111","331275"],["331276","339096"],["339097","345421"],\
["345422","348048"],["348049","351462"],["351463","352597"],["352598","359362"],["359363","361397"],\
["361398","363153"],["363154","377375"],["377376","380819"],["380820","385149"],["385150","387549"],\
["387550","389610"],["389611","391323"],["391324","393196"],["393197","395929"],["395930","397765"],\
["397766","398981"],["398982","401098"],["401099","402478"],["402479","403901"],["403902","405523"],\
["405524","414398"],["414399","418687"],["418688","420329"],["420330","425238"],["425239","426940"],\
["426941","430015"],["430016","434967"],["434968","436313"],["436314","438130"],["438131","441734"],\
["441735","444473"],["444474","445923"],["445924","449006"],["449007","451076"],["451077","452545"],\
["452546","453860"],["453861","460285"],["460286","463023"],["463024","464458"],["464459","466220"],\
["466221","471976"],["471977","476075"],["476076","477544"],["477545","481928"],["481929","483849"],\
["483850","485498"],["485499","487158"],["487159","492147"],["492148","493090"],["493091","497622"],\
["497623","504774"],["504775","507190"],["507191","508780"],["508781","512660"],["512661","514191"],\
["514192","517139"],["517140","522125"],["522126","525304"],["525305","528390"],["528391","533747"],\
["533748","538238"],["538239","544479"],["544480","550131"],["550132","552041"],["552042","555809"],\
["555810","559638"],["559639","560589"],["560590","565050"],["565051","566990"],["566991","567832"],\
["567833","569214"],["569215","571258"],["571259","575111"],["575112","591928"],["591929","592896"],\
["592897","594151"],["594152","599442"],["599443","601039"],["601040","603927"],["603928","605453"],\
["605454","606370"],["606371","613051"],["613052","614170"],["614171","617177"],["617178","618671"],\
["618672","620194"],["620195","623209"],["623210","628607"],["628608","635114"],["635115","643901"],\
["643902","645224"],["645225","647075"],["647076","651538"],["651539","655129"],["655130","658202"],\
["658203","672755"],["672756","683111"],["683112","688853"],["688854","696605"],["696606","701572"],\
["701573","709966"],["709967","712581"],["712582","715544"],["715545","719034"],["719035","726198"],\
["726199","733252"],["733253","739261"],["739262","741403"],["741404","743697"],["743698","748034"],\
["748035","752840"],["752841","758369"],["758370","761674"],["761675","769286"],["769287","772127"],\
["772128","774749"],["774750","776915"],["776916","779461"],["779462","793104"],["793105","795597"],\
["795598","799683"],["799684","803337"],["803338","808255"],["808256","811007"]]

shuffle(partitions)
print(partitions)

for i in ["0", "1", "2"]: #this can be changed based on the number of data points you want
                          #for ATN, AFO, & CFS: 0,1,2; for CKS: 0,1,2,3,4,5 because of fewer samples
  with open("Coll_f_s_supermatrix.fas") as inFile, open("resampled_{}_{}.fas".format(args.num, i), "w") as outFile:
    shuffle(partitions)
    keepers = []
    for record in SeqIO.parse(inFile, "fasta"):
      oldSeq = record.seq
      record.seq = ""
      for parts in partitions[:int(args.num)]:
        record.seq += oldSeq[int(parts[0])-1:int(parts[1])]
      keepers.append(record)
    SeqIO.write(keepers, outFile, "fasta-2line")
